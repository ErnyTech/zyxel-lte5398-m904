Index: linux-3.10.14/net/8021q/vlan_core.c
===================================================================
--- linux-3.10.14.orig/net/8021q/vlan_core.c	2016-01-08 14:07:04.000000000 +0800
+++ linux-3.10.14/net/8021q/vlan_core.c	2021-02-04 10:13:03.136181999 +0800
@@ -12,7 +12,10 @@
 	u16 vlan_id = vlan_tx_tag_get_id(skb);
 	struct net_device *vlan_dev;
 	struct vlan_pcpu_stats *rx_stats;
-
+#ifdef CONFIG_VLAN_PRIO_MARK
+	unsigned char prio = 0;
+	unsigned short vlan8021pToPriorityQueueVlan[8] = {2,0,1,3,4,5,6,7};
+#endif
 	vlan_dev = vlan_find_dev(skb->dev, vlan_proto, vlan_id);
 	if (!vlan_dev)
 		return false;
@@ -48,6 +51,11 @@
 	}
 
 	skb->priority = vlan_get_ingress_priority(vlan_dev, skb->vlan_tci);
+#ifdef CONFIG_VLAN_PRIO_MARK
+	prio = ((skb->vlan_tci)>> 13) & 0x7;
+	//printk("prio : 0x%X\n", prio);
+	skb->mark |= vlan8021pToPriorityQueueVlan[prio];
+#endif
 	skb->vlan_tci = 0;
 
 	rx_stats = this_cpu_ptr(vlan_dev_priv(vlan_dev)->vlan_pcpu_stats);
Index: linux-3.10.14/net/8021q/Kconfig
===================================================================
--- linux-3.10.14.orig/net/8021q/Kconfig	2021-02-04 11:23:30.424181999 +0800
+++ linux-3.10.14/net/8021q/Kconfig	2021-02-04 11:21:59.412181999 +0800
@@ -38,3 +38,8 @@
 	  supersedes GVRP and is not backwards-compatible.
 
 	  If unsure, say N.
+
+config VLAN_PRIO_MARK
+	bool "VLAN PRIO MARK SUPPORT"
+	default n
+	depends on VLAN_8021Q
